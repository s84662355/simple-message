<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>simple-message 使用文档</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#10b981',
                        dark: '#1e293b',
                        light: '#f8fafc',
                        darkMode: {
                            bg: '#121212',
                            card: '#1e1e1e',
                            text: '#e0e0e0',
                            border: '#333333',
                            code: '#2d2d2d'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['Fira Code', 'monospace']
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .bg-gradient {
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            }
            .code-block {
                position: relative;
            }
            .copy-btn {
                position: absolute;
                top: 0.5rem;
                right: 0.5rem;
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            .code-block:hover .copy-btn {
                opacity: 1;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800 transition-colors duration-300" id="body">
    <!-- 顶部导航 -->
    <header class="sticky top-0 z-50 bg-white shadow-md transition-colors duration-300" id="header">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-exchange text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-dark transition-colors duration-300" id="headerTitle">simple-message</h1>
            </div>
            <div class="flex items-center space-x-4">
                <!-- 主题切换按钮 -->
                <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                    <i class="fa fa-moon-o text-gray-600 transition-colors duration-300" id="themeIcon"></i>
                </button>
                
                <button id="downloadBtn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-colors flex items-center">
                    <i class="fa fa-download mr-2"></i>
                    <span>下载文档</span>
                </button>
                
                <nav class="hidden md:flex space-x-6">
                    <a href="#overview" class="hover:text-primary transition-colors">概述</a>
                    <a href="#installation" class="hover:text-primary transition-colors">安装</a>
                    <a href="#quickstart" class="hover:text-primary transition-colors">快速开始</a>
                    <a href="#modules" class="hover:text-primary transition-colors">核心模块</a>
                    <a href="#api" class="hover:text-primary transition-colors">API 参考</a>
                </nav>
                
                <button id="menuToggle" class="md:hidden text-gray-600 focus:outline-none">
                    <i class="fa fa-bars text-xl"></i>
                </button>
            </div>
        </div>
        
        <!-- 移动端菜单 -->
        <div id="mobileMenu" class="hidden md:hidden bg-white border-t transition-colors duration-300" id="mobileMenu">
            <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
                <a href="#overview" class="py-2 hover:text-primary transition-colors">概述</a>
                <a href="#installation" class="py-2 hover:text-primary transition-colors">安装</a>
                <a href="#quickstart" class="py-2 hover:text-primary transition-colors">快速开始</a>
                <a href="#modules" class="py-2 hover:text-primary transition-colors">核心模块</a>
                <a href="#api" class="py-2 hover:text-primary transition-colors">API 参考</a>
                <a href="#" id="mobileDownload" class="py-2 text-primary transition-colors flex items-center">
                    <i class="fa fa-download mr-2"></i>
                    <span>下载文档</span>
                </a>
            </div>
        </div>
    </header>

    <!-- 主要内容 -->
    <main class="container mx-auto px-4 py-8 flex flex-col md:flex-row gap-8">
        <!-- 侧边导航 (桌面版) -->
        <aside class="hidden lg:block w-64 flex-shrink-0">
            <div class="sticky top-24 bg-white rounded-xl shadow p-4 transition-colors duration-300" id="sidebar">
                <h3 class="font-semibold text-lg mb-4 pb-2 border-b transition-colors duration-300" id="sidebarTitle">目录</h3>
                <nav class="space-y-2 text-sm">
                    <a href="#overview" class="block py-1 hover:text-primary transition-colors">项目概述</a>
                    <a href="#installation" class="block py-1 hover:text-primary transition-colors">安装方法</a>
                    <a href="#quickstart" class="block py-1 hover:text-primary transition-colors">快速开始</a>
                    <div class="pl-3 mt-1 space-y-1">
                        <a href="#quickstart-server" class="block py-1 hover:text-primary transition-colors">服务器端示例</a>
                        <a href="#quickstart-client" class="block py-1 hover:text-primary transition-colors">客户端示例</a>
                    </div>
                    <a href="#modules" class="block py-1 hover:text-primary transition-colors">核心模块说明</a>
                    <div class="pl-3 mt-1 space-y-1">
                        <a href="#module-protocol" class="block py-1 hover:text-primary transition-colors">protocol 包</a>
                        <a href="#module-connection" class="block py-1 hover:text-primary transition-colors">connection 包</a>
                        <a href="#module-server" class="block py-1 hover:text-primary transition-colors">server 包</a>
                        <a href="#module-client" class="block py-1 hover:text-primary transition-colors">client 包</a>
                        <a href="#module-nqueue" class="block py-1 hover:text-primary transition-colors">nqueue 包</a>
                    </div>
                    <a href="#api" class="block py-1 hover:text-primary transition-colors">API 参考</a>
                    <div class="pl-3 mt-1 space-y-1">
                        <a href="#api-connection" class="block py-1 hover:text-primary transition-colors">Connection 接口</a>
                        <a href="#api-server" class="block py-1 hover:text-primary transition-colors">Server 接口</a>
                        <a href="#api-client" class="block py-1 hover:text-primary transition-colors">Client 接口</a>
                    </div>
                </nav>
            </div>
        </aside>

        <!-- 文档内容 -->
        <div class="flex-1 max-w-4xl mx-auto">
            <!-- 项目概述 -->
            <section id="overview" class="mb-16">
                <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 transition-colors duration-300" id="overviewCard">
                    <div class="flex items-center mb-6">
                        <div class="bg-primary/10 p-3 rounded-full mr-4">
                            <i class="fa fa-info-circle text-primary text-2xl"></i>
                        </div>
                        <h2 class="text-2xl md:text-3xl font-bold text-dark transition-colors duration-300" id="overviewTitle">项目概述</h2>
                    </div>
                    <p class="text-gray-700 mb-4 leading-relaxed transition-colors duration-300" id="overviewText">
                        <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="overviewCode">simple-message</code> 是一个基于 Go 语言的轻量级 TCP 消息通信库，提供了客户端与服务器端的完整实现，
                        支持消息编解码、连接管理、并发消息处理等核心功能。通过模块化设计，简化了 TCP 通信中的底层细节，让开发者可以专注于业务逻辑的实现。
                    </p>
                    
                    <div class="grid md:grid-cols-3 gap-4 mt-8">
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 transition-colors duration-300" id="feature1">
                            <div class="flex items-center mb-2">
                                <i class="fa fa-code text-primary mr-2"></i>
                                <h3 class="font-semibold transition-colors duration-300" id="feature1Title">简单易用</h3>
                            </div>
                            <p class="text-sm text-gray-600 transition-colors duration-300" id="feature1Text">封装底层 TCP 细节，提供简洁 API，快速实现通信功能</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg border border-green-100 transition-colors duration-300" id="feature2">
                            <div class="flex items-center mb-2">
                                <i class="fa fa-shield text-secondary mr-2"></i>
                                <h3 class="font-semibold transition-colors duration-300" id="feature2Title">并发安全</h3>
                            </div>
                            <p class="text-sm text-gray-600 transition-colors duration-300" id="feature2Text">使用读写锁和原子操作，确保高并发场景下的稳定性</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-100 transition-colors duration-300" id="feature3">
                            <div class="flex items-center mb-2">
                                <i class="fa fa-refresh text-purple-500 mr-2"></i>
                                <h3 class="font-semibold transition-colors duration-300" id="feature3Title">自动重连</h3>
                            </div>
                            <p class="text-sm text-gray-600 transition-colors duration-300" id="feature3Text">客户端内置自动重连机制，提升连接可靠性</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 安装方法 -->
            <section id="installation" class="mb-16">
                <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 transition-colors duration-300" id="installationCard">
                    <div class="flex items-center mb-6">
                        <div class="bg-primary/10 p-3 rounded-full mr-4">
                            <i class="fa fa-download text-primary text-2xl"></i>
                        </div>
                        <h2 class="text-2xl md:text-3xl font-bold text-dark transition-colors duration-300" id="installationTitle">安装方法</h2>
                    </div>
                    <p class="text-gray-700 mb-4 transition-colors duration-300" id="installationText">使用 <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="installationCode">go get</code> 命令安装：</p>
                    <div class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto font-mono text-sm code-block transition-colors duration-300" id="installationCommand">
                        <pre>go get github.com/s84662355/simple-message</pre>
                        <button class="copy-btn bg-gray-700 hover:bg-gray-600 text-white px-2 py-1 rounded text-xs" data-target="installationCommand">
                            <i class="fa fa-copy mr-1"></i>复制
                        </button>
                    </div>
                    <div class="mt-4 text-gray-600 text-sm transition-colors duration-300" id="dependenciesText">
                        <p><i class="fa fa-info-circle text-primary mr-1"></i> 依赖项：</p>
                        <div class="bg-gray-50 p-3 rounded-md mt-1 font-mono code-block transition-colors duration-300" id="dependenciesCode">
                            <pre>github.com/s84662355/nqueue v0.0.0-20250906090220-e56d62ad8b24</pre>
                            <button class="copy-btn bg-gray-200 hover:bg-gray-300 text-gray-800 px-2 py-1 rounded text-xs" data-target="dependenciesCode">
                                <i class="fa fa-copy mr-1"></i>复制
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 快速开始 -->
            <section id="quickstart" class="mb-16">
                <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 transition-colors duration-300" id="quickstartCard">
                    <div class="flex items-center mb-6">
                        <div class="bg-primary/10 p-3 rounded-full mr-4">
                            <i class="fa fa-bolt text-primary text-2xl"></i>
                        </div>
                        <h2 class="text-2xl md:text-3xl font-bold text-dark transition-colors duration-300" id="quickstartTitle">快速开始</h2>
                    </div>

                    <!-- 服务器端示例 -->
                    <div id="quickstart-server" class="mb-10">
                        <h3 class="text-xl font-semibold mb-4 text-dark border-l-4 border-primary pl-3 transition-colors duration-300" id="serverExampleTitle">服务器端示例</h3>
                        <div class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto font-mono text-sm code-block transition-colors duration-300" id="serverCode">
<pre>package main

import (
    "context"
    "fmt"
    "net"
    "os"
    "os/signal"
    "syscall"

    "github.com/s84662355/simple-message/connection"
    "github.com/s84662355/simple-message/server"
)

// Handler1 消息处理器，用于处理MsgID=1的消息
type Handler1 struct{}

// Handle 实现消息处理接口
func (h *Handler1) Handle(request connection.IRequest) {
    // 处理消息逻辑
    fmt.Printf("收到消息 - ID: %d, 内容: %s\n", 
        request.GetMsgID(), 
        string(request.GetData()))
}

// Listener 自定义监听器实现，包装net.Listener
type Listener struct {
    listener net.Listener
}

// Accept 实现Accept接口，返回读写关闭器
func (l *Listener) Accept() (connection.Conn, error) {
    return l.listener.Accept()
}

// Close 实现关闭接口
func (l *Listener) Close() error {
    return l.listener.Close()
}

type Action struct{}

// 连接错误回调
func (l *Action) ConnErr(ctx context.Context, conn *connection.Connection, err error) {
    fmt.Printf("连接错误: %v, 连接信息: %v\n", err, conn)
}

// 连接建立回调
func (l *Action) ConnectedBegin(ctx context.Context, conn *connection.Connection) {
    // 向新连接发送欢迎消息
    if err := conn.SendMsg(1, []byte("欢迎连接到服务器")); err != nil {
        fmt.Printf("发送消息失败: %v\n", err)
    }
    fmt.Printf("新连接建立: %v\n", conn)
}

func main() {
    // 创建TCP监听器，监听2000端口
    listener, err := net.Listen("tcp", ":2000")
    if err != nil {
        fmt.Printf("创建监听器失败: %v\n", err)
        return
    }
    defer listener.Close()

    // 注册消息处理器，MsgID=1对应Handler1
    handlers := map[uint32]connection.Handler{
        1: &Handler1{},
    }

    // 包装自定义监听器
    customListener := &Listener{
        listener: listener,
    }

    // 创建服务器实例
    srv := server.NewServer(
        customListener,
        handlers,
        1024*1024, // 最大数据长度 (1MB)
        1024,      // 最大连接数
        new(Action),
    )

    // 启动服务器，使用16个accept协程
    done := srv.Start(16)
    defer func() {
        // 停止服务器并等待完成
        srv.Stop()
        <-done
        fmt.Println("服务器已完全停止")
    }()

    // 设置信号监听，处理程序退出
    signalChan := make(chan os.Signal, 1)
    signal.Notify(
        signalChan,
        syscall.SIGINT,  // Ctrl+C中断
        syscall.SIGTERM, // 终止信号
        os.Kill,         // 强制终止
    )

    fmt.Println("服务器已启动，监听端口: 2000")
    fmt.Println("按Ctrl+C停止服务器")

    // 等待退出信号或服务器完成信号
    select {
    case <-done:
        fmt.Println("服务器正常退出")
    case sig := <-signalChan:
        fmt.Printf("收到退出信号: %v，正在停止服务器...\n", sig)
    }
}</pre>
                            <button class="copy-btn bg-gray-700 hover:bg-gray-600 text-white px-2 py-1 rounded text-xs" data-target="serverCode">
                                <i class="fa fa-copy mr-1"></i>复制
                            </button>
                        </div>
                    </div>

                    <!-- 客户端示例 -->
                    <div id="quickstart-client">
                        <h3 class="text-xl font-semibold mb-4 text-dark border-l-4 border-secondary pl-3 transition-colors duration-300" id="clientExampleTitle">客户端示例</h3>
                        <div class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto font-mono text-sm code-block transition-colors duration-300" id="clientCode">
<pre>package main

import (
    "context"
    "fmt"
    "net"
    "os"
    "os/signal"
    "syscall"

    "github.com/s84662355/simple-message/client"
    "github.com/s84662355/simple-message/connection"
)

// Handler1 消息处理器，用于处理MsgID=1的消息
type Handler1 struct{}

// Handle 实现消息处理接口，打印收到的消息ID和内容
func (h *Handler1) Handle(request connection.IRequest) {
    fmt.Printf("收到消息 - ID: %d, 内容: %s\n",
        request.GetMsgID(),
        string(request.GetData()))
}

type Action struct{}

func (a *Action) DialContext(ctx context.Context) (connection.Conn, error) {
    var d net.Dialer
    // 连接到本地2000端口的TCP服务器
    conn, err := d.DialContext(ctx, "tcp", "127.0.0.1:2000")
    if err != nil {
        return nil, fmt.Errorf("连接失败: %w", err)
    }

    // 可选：配置TCP连接属性（如心跳机制）
    if tcpConn, ok := conn.(*net.TCPConn); ok {
        // 启用TCP保活机制
        if err := tcpConn.SetKeepAlive(true); err != nil {
            fmt.Printf("设置TCP保活失败: %v\n", err)
        }
    }

    return conn, nil
}

// 拨号错误回调
func (a *Action) DialErr(ctx context.Context, err error) {
    fmt.Printf("拨号错误: %v, 准备重连...\n", err)
}

func (a *Action) ConnErr(ctx context.Context, conn *connection.Connection, err error) {
    fmt.Printf("连接错误: %v, 连接信息: %v, 准备重连...\n", err, conn)
}

func (a *Action) ConnectedBegin(ctx context.Context, conn *connection.Connection) {
    fmt.Printf("成功连接到服务器: %v\n", conn)
    // 发送初始化消息
    if err := conn.SendMsg(1, []byte("客户端已连接")); err != nil {
        fmt.Printf("发送消息失败: %v\n", err)
    }
}

func main() {
    // 注册消息处理器，MsgID=1对应Handler1
    handlers := map[uint32]connection.Handler{
        1: &Handler1{},
    }

    // 创建客户端实例
    c := client.NewClient(
        handlers,  // 消息处理器映射
        1024*1024, // 最大数据长度 (1MB)
        new(Action),
    )

    // 确保程序退出时正确停止客户端
    defer func() {
        fmt.Println("正在关闭客户端...")
        // 等待客户端完全停止
        <-c.Stop()
        fmt.Println("客户端已完全停止")
    }()

    // 设置信号监听，处理程序退出
    signalChan := make(chan os.Signal, 1)
    signal.Notify(
        signalChan,
        syscall.SIGINT,  // Ctrl+C中断
        syscall.SIGTERM, // 终止信号
        os.Kill,         // 强制终止
    )

    fmt.Println("客户端已启动，正在连接到服务器 127.0.0.1:2000...")
    fmt.Println("按Ctrl+C停止客户端")

    // 等待退出信号
    <-signalChan
    fmt.Println("收到退出信号，正在停止客户端...")
}</pre>
                            <button class="copy-btn bg-gray-700 hover:bg-gray-600 text-white px-2 py-1 rounded text-xs" data-target="clientCode">
                                <i class="fa fa-copy mr-1"></i>复制
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 核心模块说明 -->
            <section id="modules" class="mb-16">
                <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 transition-colors duration-300" id="modulesCard">
                    <div class="flex items-center mb-6">
                        <div class="bg-primary/10 p-3 rounded-full mr-4">
                            <i class="fa fa-cubes text-primary text-2xl"></i>
                        </div>
                        <h2 class="text-2xl md:text-3xl font-bold text-dark transition-colors duration-300" id="modulesTitle">核心模块说明</h2>
                    </div>

                    <!-- protocol 包 -->
                    <div id="module-protocol" class="mb-10">
                        <div class="flex items-center mb-4">
                            <div class="bg-blue-100 p-2 rounded-full mr-3">
                                <i class="fa fa-exchange text-blue-600"></i>
                            </div>
                            <h3 class="text-xl font-semibold text-dark transition-colors duration-300" id="protocolTitle">1. protocol 包（消息协议）</h3>
                        </div>
                        <p class="text-gray-700 mb-4 pl-9 transition-colors duration-300" id="protocolDesc">负责消息的编解码，定义了消息格式和传输规则。</p>
                        
                        <div class="pl-9 mb-4">
                            <h4 class="font-semibold text-gray-800 mb-2 transition-colors duration-300" id="protocolStructsTitle">核心结构</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-2 transition-colors duration-300" id="protocolStructsList">
                                <li>
                                    <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="protocolStruct1">Message</code>：消息载体
                                    <div class="bg-gray-50 p-3 rounded-md mt-2 ml-6 font-mono text-sm code-block transition-colors duration-300" id="protocolCode1">
<pre>type Message struct {
    MsgID uint32 // 消息唯一标识
    Data  []byte // 消息内容
}</pre>
                                        <button class="copy-btn bg-gray-200 hover:bg-gray-300 text-gray-800 px-2 py-1 rounded text-xs" data-target="protocolCode1">
                                            <i class="fa fa-copy mr-1"></i>复制
                                        </button>
                                    </div>
                                </li>
                                <li>
                                    <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="protocolStruct2">Decoder</code>：消息编解码器
                                    <ul class="list-circle list-inside mt-1 ml-4 text-gray-700 transition-colors duration-300" id="protocolStruct2List">
                                        <li>协议格式：<code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="protocolFormat">4字节MsgID + 4字节数据长度 + 数据内容</code></li>
                                        <li>支持最大数据长度限制（防止超大消息攻击）</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="pl-9">
                            <h4 class="font-semibold text-gray-800 mb-2 transition-colors duration-300" id="protocolMethodsTitle">主要方法</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 transition-colors duration-300" id="protocolMethodsList">
                                <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="protocolMethod1">Unmarshal(conn io.Reader) (*Message, error)</code>：从连接读取并解析消息</li>
                                <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="protocolMethod2">Marshal(conn io.Writer, MsgID uint32, data []byte) error</code>：将消息编码并写入连接</li>
                            </ul>
                        </div>
                    </div>

                    <!-- connection 包 -->
                    <div id="module-connection" class="mb-10">
                        <div class="flex items-center mb-4">
                            <div class="bg-green-100 p-2 rounded-full mr-3">
                                <i class="fa fa-plug text-green-600"></i>
                            </div>
                            <h3 class="text-xl font-semibold text-dark transition-colors duration-300" id="connectionTitle">2. connection 包（连接管理）</h3>
                        </div>
                        <p class="text-gray-700 mb-4 pl-9 transition-colors duration-300" id="connectionDesc">封装 TCP 连接的核心逻辑，包括消息收发、连接属性管理等。</p>
                        
                        <div class="pl-9 mb-4">
                            <h4 class="font-semibold text-gray-800 mb-2 transition-colors duration-300" id="connectionStructsTitle">核心结构</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-2 transition-colors duration-300" id="connectionStructsList">
                                <li>
                                    <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionStruct1">Connection</code>：连接实例
                                    <ul class="list-circle list-inside mt-1 ml-4 text-gray-700 transition-colors duration-300" id="connectionStruct1List">
                                        <li>支持消息发送（<code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionMethod1">SendMsg</code>/<code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionMethod2">SendMsgContext</code>）</li>

                                        <li>连接属性存储（
                                            <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionMethod3">StoreProperty</code>
                                            /
                                            <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionMethod4">LoadProperty</code>
                                            /

                                            <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionMethod3">DeleteProperty</code>
                                            /
                                            <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionMethod3">ClearProperty</code>
                                            /
                                            <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionMethod3">CompareAndDeleteProperty</code>
                                            /
                                            <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionMethod3">CompareAndSwapProperty</code>
                                            /
                                            <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionMethod3">LoadAndDeleteProperty</code>
                                            /
                                            <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionMethod3">LoadOrStoreProperty</code>
                                            /
                                            <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionMethod3">RangeProperty</code>
                                            /
                                            <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionMethod3">SwapProperty</code>
 
                                            ）
                                        </li>


                                        <li>连接关闭（<code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionMethod5">Close</code>）</li>
                                    </ul>
                                </li>
                                <li>
                                    <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionStruct2">Handler</code>：消息处理接口
                                    <div class="bg-gray-50 p-3 rounded-md mt-2 ml-6 font-mono text-sm code-block transition-colors duration-300" id="connectionCode1">
<pre>type Handler interface {
    Handle(request IRequest)
}</pre>
                                        <button class="copy-btn bg-gray-200 hover:bg-gray-300 text-gray-800 px-2 py-1 rounded text-xs" data-target="connectionCode1">
                                            <i class="fa fa-copy mr-1"></i>复制
                                        </button>
                                    </div>
                                </li>
                                <li>
                                    <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="connectionStruct3">IRequest</code>：消息请求接口
                                    <ul class="list-circle list-inside mt-1 ml-4 text-gray-700 transition-colors duration-300" id="connectionStruct3List">
                                        <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="irequestMethod1">GetConnection()</code>：获取当前连接</li>
                                        <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="irequestMethod2">GetData()</code>：获取消息数据</li>
                                        <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="irequestMethod3">GetMsgID()</code>：获取消息ID</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="pl-9">
                            <h4 class="font-semibold text-gray-800 mb-2 transition-colors duration-300" id="connectionFlowTitle">消息处理流程</h4>
                            <ol class="list-decimal list-inside text-gray-700 space-y-1 ml-4 transition-colors duration-300" id="connectionFlowList">
                                <li>从 TCP 连接读取数据并解析为 <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="flowMessage">Message</code></li>
                                <li>将消息存入缓冲队列（<code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="flowNqueue">nqueue</code>）</li>
                                <li>消费队列消息，调用对应 <code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="flowHandler">Handler</code> 处理</li>
                            </ol>
                        </div>
                    </div>

                    <!-- server 包 -->
                    <div id="module-server" class="mb-10">
                        <div class="flex items-center mb-4">
                            <div class="bg-purple-100 p-2 rounded-full mr-3">
                                <i class="fa fa-server text-purple-600"></i>
                            </div>
                            <h3 class="text-xl font-semibold text-dark transition-colors duration-300" id="serverTitle">3. server 包（服务器端）</h3>
                        </div>
                        <p class="text-gray-700 mb-4 pl-9 transition-colors duration-300" id="serverDesc">实现 TCP 服务器功能，负责监听端口、接受连接并管理。</p>
                        
                        <div class="pl-9 mb-4">
                            <h4 class="font-semibold text-gray-800 mb-2 transition-colors duration-300" id="serverStructsTitle">核心结构</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 transition-colors duration-300" id="serverStructsList">
                                <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="serverStruct1">Server</code>：服务器实例</li>
                                <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="serverStruct2">Listener</code>：服务器监听接口</li>
                                <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="serverStruct3">Action</code>：服务器回调接口</li>
                            </ul>
                        </div>
                        
                        <div class="pl-9 mb-4">
                            <h4 class="font-semibold text-gray-800 mb-2 transition-colors duration-300" id="serverMethodsTitle">主要方法</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 transition-colors duration-300" id="serverMethodsList">
                                <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="serverMethod1">NewServer(...) *Server</code>：创建服务器实例</li>
                                <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="serverMethod2">Start(acceptAmount int) &lt;-chan struct{}</code>：启动服务器（指定 accept 协程数量）</li>
                                <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="serverMethod3">Stop()</code>：停止服务器并释放资源</li>
                            </ul>
                        </div>
                        
                        <div class="pl-9">
                            <h4 class="font-semibold text-gray-800 mb-2 transition-colors duration-300" id="serverFeaturesTitle">关键特性</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4 transition-colors duration-300" id="serverFeaturesList">
                                <li>支持最大连接数限制</li>
                                <li>多协程处理连接接入</li>
                                <li>连接生命周期管理</li>
                                <li>通过<code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="serverFeatureAction">Action</code>接口提供回调扩展</li>
                            </ul>
                        </div>
                    </div>

                    <!-- client 包 -->
                    <div id="module-client" class="mb-10">
                        <div class="flex items-center mb-4">
                            <div class="bg-yellow-100 p-2 rounded-full mr-3">
                                <i class="fa fa-laptop text-yellow-600"></i>
                            </div>
                            <h3 class="text-xl font-semibold text-dark transition-colors duration-300" id="clientTitle">4. client 包（客户端）</h3>
                        </div>
                        <p class="text-gray-700 mb-4 pl-9 transition-colors duration-300" id="clientDesc">实现 TCP 客户端功能，负责与服务器建立连接及重连。</p>
                        
                        <div class="pl-9 mb-4">
                            <h4 class="font-semibold text-gray-800 mb-2 transition-colors duration-300" id="clientStructsTitle">核心结构</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 transition-colors duration-300" id="clientStructsList">
                                <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="clientStruct1">Client</code>：客户端实例</li>
                                <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="clientStruct2">Action</code>：客户端行为接口，定义了拨号、错误处理等方法</li>
                            </ul>
                        </div>
                        
                        <div class="pl-9 mb-4">
                            <h4 class="font-semibold text-gray-800 mb-2 transition-colors duration-300" id="clientMethodsTitle">主要方法</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 transition-colors duration-300" id="clientMethodsList">
                                <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="clientMethod1">NewClient(handlers map[uint32]connection.Handler, maxDataLen uint32, action Action) *Client</code>：创建客户端实例</li>
                                <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="clientMethod2">Start()</code>：启动客户端</li>
                                <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="clientMethod3">Stop() &lt;-chan struct{}</code>：停止客户端并释放资源</li>
                                <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="clientMethod4">GetConnection() *connection.Connection</code>：获取当前连接</li>
                            </ul>
                        </div>
                        
                        <div class="pl-9">
                            <h4 class="font-semibold text-gray-800 mb-2 transition-colors duration-300" id="clientFeaturesTitle">关键特性</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4 transition-colors duration-300" id="clientFeaturesList">
                                <li>自动重连机制（通过<code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="clientFeatureAction">Action</code>接口实现）</li>
                                <li>连接状态监听</li>
                                <li>与服务器端统一的消息处理接口</li>
                                <li>上下文感知的连接管理</li>
                            </ul>
                        </div>
                    </div>

                    <!-- nqueue 包 -->
                    <div id="module-nqueue">
                        <div class="flex items-center mb-4">
                            <div class="bg-red-100 p-2 rounded-full mr-3">
                                <i class="fa fa-list text-red-600"></i>
                            </div>
                            <h3 class="text-xl font-semibold text-dark transition-colors duration-300" id="nqueueTitle">5. nqueue 包（消息队列）</h3>
                        </div>
                        <p class="text-gray-700 mb-4 pl-9 transition-colors duration-300" id="nqueueDesc">提供并发安全的消息队列，用于缓冲消息，避免处理阻塞。</p>
                        
                        <div class="pl-9 mb-4">
                            <h4 class="font-semibold text-gray-800 mb-2 transition-colors duration-300" id="nqueueStructsTitle">核心结构</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 transition-colors duration-300" id="nqueueStructsList">
                                <li><code class="bg-gray-100 px-1 py-0.5 rounded font-mono transition-colors duration-300" id="nqueueStruct1">NQueue[T]</code>：泛型队列实现，支持任意类型的消息存储</li>
                            </ul>
                        </div>
                        
                        <div class="pl-9">
                            <h4 class="font-semibold text-gray-800 mb-2 transition-colors duration-300" id="nqueuePurposeTitle">主要作用</h4>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4 transition-colors duration-300" id="nqueuePurposeList">
                                <li>平衡消息生产与消费速度差异</li>
                                <li>提供异步消息处理能力</li>
                                <li>支持带等待的消息出队操作</li>
                                <li>线程安全的队列操作</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- API 参考 -->
            <section id="api" class="mb-16">
                <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 transition-colors duration-300" id="apiCard">
                    <div class="flex items-center mb-6">
                        <div class="bg-primary/10 p-3 rounded-full mr-4">
                            <i class="fa fa-book text-primary text-2xl"></i>
                        </div>
                        <h2 class="text-2xl md:text-3xl font-bold text-dark transition-colors duration-300" id="apiTitle">API 参考</h2>
                    </div>

                    <!-- Connection 接口 -->
                    <div id="api-connection" class="mb-10">
                        <h3 class="text-xl font-semibold mb-4 text-dark transition-colors duration-300" id="connectionApiTitle">Connection 接口</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200 transition-colors duration-300" id="connectionApiTable">
                                <thead>
                                    <tr class="bg-gray-50 transition-colors duration-300" id="connectionApiHeader">
                                        <th class="py-3 px-4 border-b text-left text-sm font-semibold text-gray-700 transition-colors duration-300" id="connectionApiTh1">方法</th>
                                        <th class="py-3 px-4 border-b text-left text-sm font-semibold text-gray-700 transition-colors duration-300" id="connectionApiTh2">说明</th>
                                        <th class="py-3 px-4 border-b text-left text-sm font-semibold text-gray-700 transition-colors duration-300" id="connectionApiTh3">参数</th>
                                        <th class="py-3 px-4 border-b text-left text-sm font-semibold text-gray-700 transition-colors duration-300" id="connectionApiTh4">返回值</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="transition-colors duration-300" id="connectionApiTr1">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd1-1">SendMsg</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd1-2">发送消息到对端</td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd1-3">msgID uint32, data []byte</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd1-4">error</td>
                                    </tr>
                                    <tr class="bg-gray-50 transition-colors duration-300" id="connectionApiTr2">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd2-1">SendMsgContext</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd2-2">带上下文的消息发送</td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd2-3">ctx context.Context, msgID uint32, data []byte</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd2-4">error</td>
                                    </tr>

                                    <tr class="transition-colors duration-300" id="connectionApiTr3">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd3-1">StoreProperty</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd3-2">设置连接属性</td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd3-3">key string, value interface{}</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd3-4">-</td>
                                    </tr>

                                    <tr class="bg-gray-50 transition-colors duration-300" id="connectionApiTr4">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-1">LoadProperty</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-2">获取连接属性</td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-3">key string</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-4">interface{}, bool</td>
                                    </tr>


                                    <tr class="bg-gray-50 transition-colors duration-300" id="connectionApiTr4">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-1">DeleteProperty</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-2">删除连接属性</td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-3">key string</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-4">-</td>
                                    </tr>


                                    <tr class="bg-gray-50 transition-colors duration-300" id="connectionApiTr4">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-1">ClearProperty</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-2">清空连接属性</td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-3">-</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-4">-</td>
                                    </tr>


                                    <tr class="bg-gray-50 transition-colors duration-300" id="connectionApiTr4">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-1">CompareAndDeleteProperty</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-2">该函数仅在当前值与指定的旧值匹配时才删除条目，你需要确保线程安全（如果存在并发访问）并正确处理值的比较。</td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-3">key, old any</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-4">deleted bool</td>
                                    </tr>


                                    <tr class="bg-gray-50 transition-colors duration-300" id="connectionApiTr4">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-1">CompareAndSwapProperty</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-2">接收三个参数：键 (key)、旧值 (old) 和新值 (new)
                                            先获取写锁确保线程安全
                                            检查键是否存在以及当前值是否与旧值相等
                                            只有当条件满足时，才会将值更新为新值并返回 true
                                            不满足条件时返回 false
                                        </td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-3">key, old, new any</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-4">swapped bool</td>
                                    </tr>


                                    <tr class="bg-gray-50 transition-colors duration-300" id="connectionApiTr4">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-1">LoadAndDeleteProperty</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-2">接收一个键作为参数
                                        获取写锁以确保线程安全和操作的原子性
                                        先读取键对应的当前值并记录键是否存在
                                        如果键存在，则删除该键值对
                                        返回读取到的值和一个布尔值（表示键是否存在）
                                        </td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-3">key any</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-4">value any, loaded bool</td>
                                    </tr>


                                    <tr class="bg-gray-50 transition-colors duration-300" id="connectionApiTr4">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-1">LoadOrStoreProperty</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-2"> 
                                                            接收键和值两个参数
                                            首先使用读锁检查键是否存在，这样可以在大多数已存在的情况下避免使用写锁，提高性能
                                            如果键存在，直接返回已有的值和true（表示值已存在）
                                            如果键不存在，获取写锁并进行双重检查（防止在获取写锁期间其他 goroutine 已设置该键）
                                            最终存储新值并返回新值和false（表示是新存储的值）
                                            性能优化：
                                            采用 "先读锁检查，必要时再写锁存储" 的模式，减少写锁竞争
                                            双重检查确保了并发环境下的数据一致性 
                                        </td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-3">key, value any</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-4">actual any, loaded bool</td>
                                    </tr>


                                    <tr class="bg-gray-50 transition-colors duration-300" id="connectionApiTr4">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-1">RangeProperty</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-2"> 

                                            接收一个函数参数 f，该函数接收键和值作为参数，并返回一个布尔值
                                            获取读锁以确保遍历过程中的线程安全，同时允许其他读操作
                                            遍历存储中的所有键值对，并对每个键值对调用函数 f
                                            如果函数 f 返回 false，则立即停止遍历 

                                        </td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-3">f func(key, value any) bool</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-4">-</td>
                                    </tr>




                                    <tr class="bg-gray-50 transition-colors duration-300" id="connectionApiTr4">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-1">SwapProperty</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-2"> 

                                            接收两个参数：键（key）和新值（newValue）
                                            获取写锁以确保线程安全和操作的原子性
                                            先获取该键当前的旧值（如果存在）
                                            无论键是否已存在，都将新值存储到该键中
                                            返回旧值和一个布尔值（表示键是否原本存在）

                                        </td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd4-3">key, value any</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd4-4">previous any, loaded bool</td>
                                    </tr>




                                    <tr class="transition-colors duration-300" id="connectionApiTr5">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd5-1">Close</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd5-2">关闭连接</td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="connectionApiTd5-3">-</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="connectionApiTd5-4">-</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Server 接口 -->
                    <div id="api-server" class="mb-10">
                        <h3 class="text-xl font-semibold mb-4 text-dark transition-colors duration-300" id="serverApiTitle">Server 接口</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200 transition-colors duration-300" id="serverApiTable">
                                <thead>
                                    <tr class="bg-gray-50 transition-colors duration-300" id="serverApiHeader">
                                        <th class="py-3 px-4 border-b text-left text-sm font-semibold text-gray-700 transition-colors duration-300" id="serverApiTh1">方法</th>
                                        <th class="py-3 px-4 border-b text-left text-sm font-semibold text-gray-700 transition-colors duration-300" id="serverApiTh2">说明</th>
                                        <th class="py-3 px-4 border-b text-left text-sm font-semibold text-gray-700 transition-colors duration-300" id="serverApiTh3">参数</th>
                                        <th class="py-3 px-4 border-b text-left text-sm font-semibold text-gray-700 transition-colors duration-300" id="serverApiTh4">返回值</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="transition-colors duration-300" id="serverApiTr1">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="serverApiTd1-1">server.NewServer</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="serverApiTd1-2">创建服务器实例</td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="serverApiTd1-3">监听器、处理器等配置参数</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="serverApiTd1-4">*Server</td>
                                    </tr>
                                    <tr class="bg-gray-50 transition-colors duration-300" id="serverApiTr2">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="serverApiTd2-1">Server.Start</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="serverApiTd2-2">启动服务器</td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="serverApiTd2-3">acceptAmount int</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="serverApiTd2-4">&lt;-chan struct{}</td>
                                    </tr>
                                    <tr class="transition-colors duration-300" id="serverApiTr3">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="serverApiTd3-1">Server.Stop</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="serverApiTd3-2">停止服务器</td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="serverApiTd3-3">-</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="serverApiTd3-4">-</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Client 接口 -->
                    <div id="api-client">
                        <h3 class="text-xl font-semibold mb-4 text-dark transition-colors duration-300" id="clientApiTitle">Client 接口</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200 transition-colors duration-300" id="clientApiTable">
                                <thead>
                                    <tr class="bg-gray-50 transition-colors duration-300" id="clientApiHeader">
                                        <th class="py-3 px-4 border-b text-left text-sm font-semibold text-gray-700 transition-colors duration-300" id="clientApiTh1">方法</th>
                                        <th class="py-3 px-4 border-b text-left text-sm font-semibold text-gray-700 transition-colors duration-300" id="clientApiTh2">说明</th>
                                        <th class="py-3 px-4 border-b text-left text-sm font-semibold text-gray-700 transition-colors duration-300" id="clientApiTh3">参数</th>
                                        <th class="py-3 px-4 border-b text-left text-sm font-semibold text-gray-700 transition-colors duration-300" id="clientApiTh4">返回值</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="transition-colors duration-300" id="clientApiTr1">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="clientApiTd1-1">client.NewClient</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="clientApiTd1-2">创建客户端实例</td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="clientApiTd1-3">处理器、最大数据长度、Action接口</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="clientApiTd1-4">*Client</td>
                                    </tr>
                                    <tr class="bg-gray-50 transition-colors duration-300" id="clientApiTr2">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="clientApiTd2-1">Client.Start</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="clientApiTd2-2">启动客户端</td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="clientApiTd2-3">-</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="clientApiTd2-4">-</td>
                                    </tr>
                                    <tr class="transition-colors duration-300" id="clientApiTr3">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="clientApiTd3-1">Client.Stop</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="clientApiTd3-2">停止客户端</td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="clientApiTd3-3">-</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="clientApiTd3-4">&lt;-chan struct{}</td>
                                    </tr>
                                    <tr class="bg-gray-50 transition-colors duration-300" id="clientApiTr4">
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="clientApiTd4-1">Client.GetConnection</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="clientApiTd4-2">获取当前连接</td>
                                        <td class="py-3 px-4 border-b text-sm font-mono transition-colors duration-300" id="clientApiTd4-3">-</td>
                                        <td class="py-3 px-4 border-b text-sm transition-colors duration-300" id="clientApiTd4-4">*connection.Connection</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark text-white py-8 transition-colors duration-300" id="footer">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center">
                        <i class="fa fa-exchange text-primary text-xl mr-2"></i>
                        <span class="font-bold text-lg transition-colors duration-300" id="footerTitle">simple-message</span>
                    </div>
                    <p class="text-gray-400 text-sm mt-2 transition-colors duration-300" id="footerDesc">轻量级 TCP 消息通信库</p>
                </div>
                <div class="text-gray-400 text-sm transition-colors duration-300" id="footerCopyright">
                    &copy; 2025 simple-message. 保留所有权利。
                </div>
            </div>
        </div>
    </footer>

    <!-- 下载文档的Markdown内容 (隐藏元素) -->
    <div id="markdownContent" class="hidden">
# simple-message 文档

## 项目概述
`simple-message` 是一个基于 Go 语言的轻量级 TCP 消息通信库，提供了客户端与服务器端的完整实现，支持消息编解码、连接管理、并发消息处理等核心功能。通过模块化设计，简化了 TCP 通信中的底层细节，让开发者可以专注于业务逻辑的实现。

### 主要特点
- **简单易用**：封装底层 TCP 细节，提供简洁 API，快速实现通信功能
- **并发安全**：使用读写锁和原子操作，确保高并发场景下的稳定性
- **自动重连**：客户端内置自动重连机制，提升连接可靠性

## 安装方法
使用 `go get` 命令安装：
go get github.com/s84662355/simple-message
## 快速开始

### 服务器端示例 
```go
package main
import (
    "context"
    "fmt"
    "net"
    "os"
    "os/signal"
    "syscall"

    "github.com/s84662355/simple-message/connection"
    "github.com/s84662355/simple-message/server"
)

// Handler1 消息处理器，用于处理MsgID=1的消息
type Handler1 struct{}

// Handle 实现消息处理接口
func (h *Handler1) Handle(request connection.IRequest) {
    // 处理消息逻辑
    fmt.Printf("收到消息 - ID: %d, 内容: %s\n", 
        request.GetMsgID(), 
        string(request.GetData()))
}

// Listener 自定义监听器实现，包装net.Listener
type Listener struct {
    listener net.Listener
}

// Accept 实现Accept接口，返回读写关闭器
func (l *Listener) Accept() (connection.Conn, error) {
    return l.listener.Accept()
}

// Close 实现关闭接口
func (l *Listener) Close() error {
    return l.listener.Close()
}

type Action struct{}

// 连接错误回调
func (l *Action) ConnErr(ctx context.Context, conn *connection.Connection, err error) {
    fmt.Printf("连接错误: %v, 连接信息: %v\n", err, conn)
}

// 连接建立回调
func (l *Action) ConnectedBegin(ctx context.Context, conn *connection.Connection) {
    // 向新连接发送欢迎消息
    if err := conn.SendMsg(1, []byte("欢迎连接到服务器")); err != nil {
        fmt.Printf("发送消息失败: %v\n", err)
    }
    fmt.Printf("新连接建立: %v\n", conn)
}

func main() {
    // 创建TCP监听器，监听2000端口
    listener, err := net.Listen("tcp", ":2000")
    if err != nil {
        fmt.Printf("创建监听器失败: %v\n", err)
        return
    }
    defer listener.Close()

    // 注册消息处理器，MsgID=1对应Handler1
    handlers := map[uint32]connection.Handler{
        1: &Handler1{},
    }

    // 包装自定义监听器
    customListener := &Listener{
        listener: listener,
    }

    // 创建服务器实例
    srv := server.NewServer(
        customListener,
        handlers,
        1024*1024, // 最大数据长度 (1MB)
        1024,      // 最大连接数
        new(Action),
    )

    // 启动服务器，使用16个accept协程
    done := srv.Start(16)
    defer func() {
        // 停止服务器并等待完成
        srv.Stop()
        <-done
        fmt.Println("服务器已完全停止")
    }()

    // 设置信号监听，处理程序退出
    signalChan := make(chan os.Signal, 1)
    signal.Notify(
        signalChan,
        syscall.SIGINT,  // Ctrl+C中断
        syscall.SIGTERM, // 终止信号
        os.Kill,         // 强制终止
    )

    fmt.Println("服务器已启动，监听端口: 2000")
    fmt.Println("按Ctrl+C停止服务器")

    // 等待退出信号或服务器完成信号
    select {
    case <-done:
        fmt.Println("服务器正常退出")
    case sig := <-signalChan:
        fmt.Printf("收到退出信号: %v，正在停止服务器...\n", sig)
    }
}
```

 
### 客户端示例 

```go
package main

import (
    "context"
    "fmt"
    "net"
    "os"
    "os/signal"
    "syscall"

    "github.com/s84662355/simple-message/client"
    "github.com/s84662355/simple-message/connection"
)

// Handler1 消息处理器，用于处理MsgID=1的消息
type Handler1 struct{}

// Handle 实现消息处理接口，打印收到的消息ID和内容
func (h *Handler1) Handle(request connection.IRequest) {
    fmt.Printf("收到消息 - ID: %d, 内容: %s\n",
        request.GetMsgID(),
        string(request.GetData()))
}

type Action struct{}

func (a *Action) DialContext(ctx context.Context) (connection.Conn, error) {
    var d net.Dialer
    // 连接到本地2000端口的TCP服务器
    conn, err := d.DialContext(ctx, "tcp", "127.0.0.1:2000")
    if err != nil {
        return nil, fmt.Errorf("连接失败: %w", err)
    }

    // 可选：配置TCP连接属性（如心跳机制）
    if tcpConn, ok := conn.(*net.TCPConn); ok {
        // 启用TCP保活机制
        if err := tcpConn.SetKeepAlive(true); err != nil {
            fmt.Printf("设置TCP保活失败: %v\n", err)
        }
    }

    return conn, nil
}

// 拨号错误回调
func (a *Action) DialErr(ctx context.Context, err error) {
    fmt.Printf("拨号错误: %v, 准备重连...\n", err)
}

func (a *Action) ConnErr(ctx context.Context, conn *connection.Connection, err error) {
    fmt.Printf("连接错误: %v, 连接信息: %v, 准备重连...\n", err, conn)
}

func (a *Action) ConnectedBegin(ctx context.Context, conn *connection.Connection) {
    fmt.Printf("成功连接到服务器: %v\n", conn)
    // 发送初始化消息
    if err := conn.SendMsg(1, []byte("客户端已连接")); err != nil {
        fmt.Printf("发送消息失败: %v\n", err)
    }
}

func main() {
    // 注册消息处理器，MsgID=1对应Handler1
    handlers := map[uint32]connection.Handler{
        1: &Handler1{},
    }

    // 创建客户端实例
    c := client.NewClient(
        handlers,  // 消息处理器映射
        1024*1024, // 最大数据长度 (1MB)
        new(Action),
    )

    // 确保程序退出时正确停止客户端
    defer func() {
        fmt.Println("正在关闭客户端...")
        // 等待客户端完全停止
        <-c.Stop()
        fmt.Println("客户端已完全停止")
    }()

    // 设置信号监听，处理程序退出
    signalChan := make(chan os.Signal, 1)
    signal.Notify(
        signalChan,
        syscall.SIGINT,  // Ctrl+C中断
        syscall.SIGTERM, // 终止信号
        os.Kill,         // 强制终止
    )

    fmt.Println("客户端已启动，正在连接到服务器 127.0.0.1:2000...")
    fmt.Println("按Ctrl+C停止客户端")

    // 等待退出信号
    <-signalChan
    fmt.Println("收到退出信号，正在停止客户端...")
}
```
## 核心模块说明

### 1. protocol 包（消息协议）
负责消息的编解码，定义了消息格式和传输规则。

#### 核心结构
- `Message`：消息载体type Message struct {
    MsgID uint32 // 消息唯一标识
    Data  []byte // 消息内容
}
- `Decoder`：消息编解码器
  - 协议格式：`4字节MsgID + 4字节数据长度 + 数据内容`
  - 支持最大数据长度限制（防止超大消息攻击）

#### 主要方法
- `Unmarshal(conn io.Reader) (*Message, error)`：从连接读取并解析消息
- `Marshal(conn io.Writer, MsgID uint32, data []byte) error`：将消息编码并写入连接

### 2. connection 包（连接管理）
封装 TCP 连接的核心逻辑，包括消息收发、连接属性管理等。

#### 核心结构
- `Connection`：连接实例
  - 支持消息发送（`SendMsg`/`SendMsgContext`）
  - 连接属性存储（`StoreProperty` / `LoadProperty`/ `DeleteProperty` / `ClearProperty` / `CompareAndDeleteProperty` / `CompareAndSwapProperty` / `LoadAndDeleteProperty` / `LoadOrStoreProperty` / `RangeProperty` / `SwapProperty` ）
  - 连接关闭（`Close`）

- `Handler`：消息处理接口type Handler interface {
    Handle(request IRequest)
}
- `IRequest`：消息请求接口
  - `GetConnection()`：获取当前连接
  - `GetData()`：获取消息数据
  - `GetMsgID()`：获取消息ID

#### 消息处理流程
1. 从 TCP 连接读取数据并解析为 `Message`
2. 将消息存入缓冲队列（`nqueue`）
3. 消费队列消息，调用对应 `Handler` 处理

### 3. server 包（服务器端）
实现 TCP 服务器功能，负责监听端口、接受连接并管理。

#### 核心结构
- `Server`：服务器实例
- `Listener`：服务器监听接口
- `Action`：服务器回调接口

#### 主要方法
- `NewServer(...) *Server`：创建服务器实例
- `Start(acceptAmount int) <-chan struct{}`：启动服务器（指定 accept 协程数量）
- `Stop()`：停止服务器并释放资源

#### 关键特性
- 支持最大连接数限制
- 多协程处理连接接入
- 连接生命周期管理
- 通过`Action`接口提供回调扩展

### 4. client 包（客户端）
实现 TCP 客户端功能，负责与服务器建立连接及重连。

#### 核心结构
- `Client`：客户端实例
- `Action`：客户端行为接口，定义了拨号、错误处理等方法

#### 主要方法
- `NewClient(handlers map[uint32]connection.Handler, maxDataLen uint32, action Action) *Client`：创建客户端实例
- `Start()`：启动客户端
- `Stop() <-chan struct{}`：停止客户端并释放资源
- `GetConnection() *connection.Connection`：获取当前连接

#### 关键特性
- 自动重连机制（通过`Action`接口实现）
- 连接状态监听
- 与服务器端统一的消息处理接口
- 上下文感知的连接管理

### 5. nqueue 包（消息队列）
提供并发安全的消息队列，用于缓冲消息，避免处理阻塞。

#### 核心结构
- `NQueue[T]`：泛型队列实现，支持任意类型的消息存储

#### 主要作用
- 平衡消息生产与消费速度差异
- 提供异步消息处理能力
- 支持带等待的消息出队操作
- 线程安全的队列操作

## API 参考

### Connection 接口

| 方法 | 说明 | 参数 | 返回值 |
|------|------|------|--------|
| SendMsg | 发送消息到对端 | msgID uint32, data []byte | error |
| SendMsgContext | 带上下文的消息发送 | ctx context.Context, msgID uint32, data []byte | error |
| StoreProperty | 设置连接属性 | key string, value interface{} | - |
| LoadProperty | 获取连接属性 | key string | interface{}, bool |
| DeleteProperty | 删除连接属性 | key string | - |
| ClearProperty | 清空连接属性 | - | - |
| CompareAndDeleteProperty | 在当前值与指定的旧值匹配时才删除条目 | key, old any | deleted bool |
| CompareAndSwapProperty | 检查键是否存在以及当前值是否与旧值相等 只有当条件满足时，才会将值更新为新值并返回 true | key, old, new any | swapped bool |
| LoadOrStoreProperty | 如果键存在，直接返回已有的值和true（表示值已存在） 如果键不存在，获取写锁并进行双重检查 | key, value any | actual any, loaded bool|
| RangeProperty | 接收一个函数参数 f，该函数接收键和值作为参数，并返回一个布尔值  | f func(key, value any) bool | - |
| SwapProperty | 先获取该键当前的旧值（如果存在） 无论键是否已存在，都将新值存储到该键中 返回旧值和一个布尔值  | key, value any | previous any, loaded bool |
| Close | 关闭连接 | - | - |

### Server 接口

| 方法 | 说明 | 参数 | 返回值 |
|------|------|------|--------|
| server.NewServer | 创建服务器实例 | 监听器、处理器等配置参数 | *Server |
| Server.Start | 启动服务器 | acceptAmount int | <-chan struct{} |
| Server.Stop | 停止服务器 | - | - |

### Client 接口

| 方法 | 说明 | 参数 | 返回值 |
|------|------|------|--------|
| client.NewClient | 创建客户端实例 | 处理器、最大数据长度、Action接口 | *Client |
| Client.Start | 启动客户端 | - | - |
| Client.Stop | 停止客户端 | - | <-chan struct{} |
| Client.GetConnection | 获取当前连接 | - | *connection.Connection |
</div>

    <script>
        // 移动端菜单切换
        document.getElementById('menuToggle').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('hidden');
        });

        // 代码复制功能
        document.querySelectorAll('.copy-btn').forEach(button => {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const codeBlock = document.getElementById(targetId);
                const code = codeBlock.querySelector('pre').textContent;
                
                navigator.clipboard.writeText(code).then(() => {
                    // 显示复制成功提示
                    const originalText = this.innerHTML;
                    this.innerHTML = '<i class="fa fa-check mr-1"></i>已复制';
                    
                    setTimeout(() => {
                        this.innerHTML = originalText;
                    }, 2000);
                }).catch(err => {
                    console.error('复制失败: ', err);
                    alert('复制失败，请手动复制');
                });
            });
        });

        // 主题切换功能
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const body = document.getElementById('body');
        const header = document.getElementById('header');
        const mobileMenu = document.getElementById('mobileMenu');
        const sidebar = document.getElementById('sidebar');
        const footer = document.getElementById('footer');
        
        // 检查本地存储中的主题偏好
        let isDarkMode = localStorage.getItem('darkMode') === 'true';
        
        // 应用初始主题
        if (isDarkMode) {
            applyDarkMode();
        }
        
        themeToggle.addEventListener('click', function() {
            isDarkMode = !isDarkMode;
            localStorage.setItem('darkMode', isDarkMode);
            
            if (isDarkMode) {
                applyDarkMode();
            } else {
                applyLightMode();
            }
        });
        
        function applyDarkMode() {
            themeIcon.classList.remove('fa-moon-o');
            themeIcon.classList.add('fa-sun-o');
            themeIcon.classList.add('text-yellow-400');
            
            body.classList.remove('bg-gray-50', 'text-gray-800');
            body.classList.add('bg-darkMode-bg', 'text-darkMode-text');
            
            header.classList.remove('bg-white', 'shadow-md');
            header.classList.add('bg-darkMode-card', 'shadow-lg');
            document.getElementById('headerTitle').classList.remove('text-dark');
            document.getElementById('headerTitle').classList.add('text-white');
            
            mobileMenu.classList.remove('bg-white', 'border-gray-200');
            mobileMenu.classList.add('bg-darkMode-card', 'border-darkMode-border');
            
            if (sidebar) {
                sidebar.classList.remove('bg-white', 'border-gray-200');
                sidebar.classList.add('bg-darkMode-card', 'border-darkMode-border');
                document.getElementById('sidebarTitle').classList.remove('text-dark', 'border-gray-200');
                document.getElementById('sidebarTitle').classList.add('text-white', 'border-darkMode-border');
            }
            
            footer.classList.remove('bg-dark');
            footer.classList.add('bg-darkMode-card');
            document.getElementById('footerTitle').classList.remove('text-white');
            document.getElementById('footerTitle').classList.add('text-white');
            document.getElementById('footerDesc').classList.remove('text-gray-400');
            document.getElementById('footerDesc').classList.add('text-gray-300');
            document.getElementById('footerCopyright').classList.remove('text-gray-400');
            document.getElementById('footerCopyright').classList.add('text-gray-300');
            
            // 处理所有卡片
            document.querySelectorAll('[id$="Card"]').forEach(card => {
                card.classList.remove('bg-white', 'border-gray-200');
                card.classList.add('bg-darkMode-card', 'border-darkMode-border');
            });
            
            // 处理所有标题
            document.querySelectorAll('[id$="Title"]').forEach(title => {
                title.classList.remove('text-dark');
                title.classList.add('text-white');
            });
            
            // 处理所有描述文本
            document.querySelectorAll('[id$="Desc"], [id$="Text"]').forEach(text => {
                text.classList.remove('text-gray-700', 'text-gray-600');
                text.classList.add('text-gray-300', 'text-gray-400');
            });
            
            // 处理所有列表
            document.querySelectorAll('[id$="List"]').forEach(list => {
                list.classList.remove('text-gray-700', 'text-gray-600');
                list.classList.add('text-gray-300');
            });
            
            // 处理所有代码元素
            document.querySelectorAll('code, [id$="Code"]').forEach(code => {
                code.classList.remove('bg-gray-100', 'text-gray-800');
                code.classList.add('bg-darkMode-code', 'text-gray-200');
            });
            
            // 处理代码块背景
            document.querySelectorAll('.bg-gray-900').forEach(block => {
                block.classList.remove('bg-gray-900');
                block.classList.add('bg-darkMode-code');
            });
            
            // 处理表格
            document.querySelectorAll('table, [id$="Table"]').forEach(table => {
                table.classList.remove('bg-white', 'border-gray-200');
                table.classList.add('bg-darkMode-card', 'border-darkMode-border');
            });
            
            document.querySelectorAll('th, [id$="Th"]').forEach(th => {
                th.classList.remove('bg-gray-50', 'text-gray-700', 'border-gray-200');
                th.classList.add('bg-darkMode-code', 'text-gray-200', 'border-darkMode-border');
            });
            
            document.querySelectorAll('td, [id$="Td"]').forEach(td => {
                td.classList.remove('border-gray-200');
                td.classList.add('border-darkMode-border');
            });
            
            document.querySelectorAll('tr, [id$="Tr"]').forEach(tr => {
                if (tr.classList.contains('bg-gray-50')) {
                    tr.classList.remove('bg-gray-50');
                    tr.classList.add('bg-darkMode-code');
                }
            });
            
            // 处理特性卡片
            document.querySelectorAll('[id^="feature"]').forEach(feature => {
                feature.classList.remove('bg-blue-50', 'bg-green-50', 'bg-purple-50', 'border-blue-100', 'border-green-100', 'border-purple-100');
                feature.classList.add('bg-darkMode-code', 'border-darkMode-border');
            });
        }
        
        function applyLightMode() {
            themeIcon.classList.remove('fa-sun-o', 'text-yellow-400');
            themeIcon.classList.add('fa-moon-o');
            
            body.classList.remove('bg-darkMode-bg', 'text-darkMode-text');
            body.classList.add('bg-gray-50', 'text-gray-800');
            
            header.classList.remove('bg-darkMode-card', 'shadow-lg');
            header.classList.add('bg-white', 'shadow-md');
            document.getElementById('headerTitle').classList.remove('text-white');
            document.getElementById('headerTitle').classList.add('text-dark');
            
            mobileMenu.classList.remove('bg-darkMode-card', 'border-darkMode-border');
            mobileMenu.classList.add('bg-white', 'border-gray-200');
            
            if (sidebar) {
                sidebar.classList.remove('bg-darkMode-card', 'border-darkMode-border');
                sidebar.classList.add('bg-white', 'border-gray-200');
                document.getElementById('sidebarTitle').classList.remove('text-white', 'border-darkMode-border');
                document.getElementById('sidebarTitle').classList.add('text-dark', 'border-gray-200');
            }
            
            footer.classList.remove('bg-darkMode-card');
            footer.classList.add('bg-dark');
            document.getElementById('footerTitle').classList.remove('text-white');
            document.getElementById('footerTitle').classList.add('text-white');
            document.getElementById('footerDesc').classList.remove('text-gray-300');
            document.getElementById('footerDesc').classList.add('text-gray-400');
            document.getElementById('footerCopyright').classList.remove('text-gray-300');
            document.getElementById('footerCopyright').classList.add('text-gray-400');
            
            // 处理所有卡片
            document.querySelectorAll('[id$="Card"]').forEach(card => {
                card.classList.remove('bg-darkMode-card', 'border-darkMode-border');
                card.classList.add('bg-white', 'border-gray-200');
            });
            
            // 处理所有标题
            document.querySelectorAll('[id$="Title"]').forEach(title => {
                title.classList.remove('text-white');
                title.classList.add('text-dark');
            });
            
            // 处理所有描述文本
            document.querySelectorAll('[id$="Desc"], [id$="Text"]').forEach(text => {
                text.classList.remove('text-gray-300', 'text-gray-400');
                text.classList.add('text-gray-700', 'text-gray-600');
            });
            
            // 处理所有列表
            document.querySelectorAll('[id$="List"]').forEach(list => {
                list.classList.remove('text-gray-300');
                list.classList.add('text-gray-700', 'text-gray-600');
            });
            
            // 处理所有代码元素
            document.querySelectorAll('code, [id$="Code"]').forEach(code => {
                code.classList.remove('bg-darkMode-code', 'text-gray-200');
                code.classList.add('bg-gray-100', 'text-gray-800');
            });
            
            // 处理代码块背景
            document.querySelectorAll('.bg-darkMode-code').forEach(block => {
                if (block.classList.contains('code-block')) {
                    block.classList.remove('bg-darkMode-code');
                    block.classList.add('bg-gray-900');
                }
            });
            
            // 处理表格
            document.querySelectorAll('table, [id$="Table"]').forEach(table => {
                table.classList.remove('bg-darkMode-card', 'border-darkMode-border');
                table.classList.add('bg-white', 'border-gray-200');
            });
            
            document.querySelectorAll('th, [id$="Th"]').forEach(th => {
                th.classList.remove('bg-darkMode-code', 'text-gray-200', 'border-darkMode-border');
                th.classList.add('bg-gray-50', 'text-gray-700', 'border-gray-200');
            });
            
            document.querySelectorAll('td, [id$="Td"]').forEach(td => {
                td.classList.remove('border-darkMode-border');
                td.classList.add('border-gray-200');
            });
            
            document.querySelectorAll('tr, [id$="Tr"]').forEach(tr => {
                if (tr.classList.contains('bg-darkMode-code')) {
                    tr.classList.remove('bg-darkMode-code');
                    tr.classList.add('bg-gray-50');
                }
            });
            
            // 处理特性卡片
            document.getElementById('feature1').classList.remove('bg-darkMode-code', 'border-darkMode-border');
            document.getElementById('feature1').classList.add('bg-blue-50', 'border-blue-100');
            
            document.getElementById('feature2').classList.remove('bg-darkMode-code', 'border-darkMode-border');
            document.getElementById('feature2').classList.add('bg-green-50', 'border-green-100');
            
            document.getElementById('feature3').classList.remove('bg-darkMode-code', 'border-darkMode-border');
            document.getElementById('feature3').classList.add('bg-purple-50', 'border-purple-100');
        }

        // 下载文档功能实现
        function downloadMarkdown() {
            // 获取Markdown内容
            const markdownContent = document.getElementById('markdownContent').textContent;
            
            // 创建Blob对象
            const blob = new Blob([markdownContent], { type: 'text/markdown' });
            
            // 创建下载链接
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'simple-message-docs.md';
            
            // 触发下载
            document.body.appendChild(a);
            a.click();
            
            // 清理资源
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // 显示下载成功提示
            alert('文档已成功下载为Markdown格式！');
        }

        // 绑定下载按钮事件
        document.getElementById('downloadBtn').addEventListener('click', downloadMarkdown);
        document.getElementById('mobileDownload').addEventListener('click', function(e) {
            e.preventDefault();
            downloadMarkdown();
        });

        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                
                // 关闭移动菜单（如果打开）
                document.getElementById('mobileMenu').classList.add('hidden');
                
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80, // 考虑固定导航的高度
                        behavior: 'smooth'
                    });
                }
            });
        });
    </script>
</body>
</html>
